<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EmotionAI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f9f9f9;
      color: #333;
    }

    .card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    .btn-primary {
      background-color: #007bff;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .btn-primary:hover {
      background-color: #0056b3;
    }

    .progress-bar {
      height: 10px;
      background-color: #007bff;
      width: 0;
      transition: width 0.3s ease-in-out;
    }
  </style>
</head>

<body>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center mb-6">EmotionAI</h1>

    <div class="max-w-2xl mx-auto">
      <!-- Subir Imagen -->
      <div class="card mb-6">
        <h2 class="text-xl font-bold mb-4">Subir Imagen</h2>
        <form id="uploadForm" enctype="multipart/form-data">
          <div class="mb-4">
            <label for="fileInput" class="block mb-2">Selecciona una imagen:</label>
            <input type="file" id="fileInput" name="image" accept=".jpg,.jpeg,.png"
              class="block w-full border border-gray-300 rounded p-2" />
          </div>
          <button type="submit" class="btn-primary">Subir y Analizar</button>
        </form>
        <div id="progressContainer" class="mt-4 hidden">
          <div class="bg-gray-300 rounded">
            <div id="progressBar" class="progress-bar"></div>
          </div>
        </div>
        <div id="errorMessage" class="mt-4 text-red-600 hidden"></div>
      </div>

      <!-- Resultados -->
      <div id="resultContainer" class="card hidden">
        <h2 class="text-xl font-bold mb-4">Resultados</h2>
        <img id="resultImage" class="w-full rounded mb-4" src="" alt="Imagen procesada" />
        <p id="emotionResult" class="text-lg font-semibold"></p>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {
      $('#uploadForm').on('submit', function (e) {
        e.preventDefault(); // Evitar comportamiento predeterminado del formulario
        const formData = new FormData(this);

        // Mostrar barra de progreso
        $('#progressContainer').removeClass('hidden');
        $('#progressBar').css('width', '0%');
        $('#errorMessage').addClass('hidden');

        $.ajax({
          url: '/upload', // Asegúrate de que esta ruta sea correcta
          type: 'POST',
          data: formData,
          contentType: false,
          processData: false,
          xhr: function () {
            const xhr = new window.XMLHttpRequest();
            xhr.upload.addEventListener('progress', function (evt) {
              if (evt.lengthComputable) {
                const percentComplete = (evt.loaded / evt.total) * 100;
                $('#progressBar').css('width', percentComplete + '%');
              }
            }, false);
            return xhr;
          },
          success: function (response) {
            // Mostrar resultados
            $('#resultContainer').removeClass('hidden');
            $('#resultImage').attr('src', response.processed_image_url);
            $('#emotionResult').text('Emoción detectada: ' + response.emotion);
          },
          error: function (xhr) {
            // Mostrar error
            $('#errorMessage').removeClass('hidden').text('Error: ' + (xhr.responseJSON?.error || 'Error inesperado.'));
          }
        });
      });

      // Prevenir la apertura de la imagen en otra ventana
      $('#fileInput').on('change', function () {
        $('#resultContainer').addClass('hidden'); // Ocultar resultados previos
        $('#errorMessage').addClass('hidden');
      });
    });
  </script>
</body>

</html>
